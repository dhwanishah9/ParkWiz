<!DOCTYPE html>
<html lang="en" ng-app="myApp">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>ParkWiz</title>

<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjFNJakTcBDyGbyNZHQNSpamaxlpWl3c0&libraries=places">
	
</script>

<!-- Bootstrap Core CSS -->
<link href="/stylesheets/bootstrap.min.css" rel="stylesheet">

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Angular Core javascript -->
<!-- <script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.0.8/angular.min.js"></script> -->
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.js"></script>

<script
	src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.js"></script>
<script
	src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.2.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- jQuery -->
<!-- <script src="/js/jquery.min.js"></script> -->


<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>
	<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular-animate.js"></script>
    <script src="//angular-ui.github.io/bootstrap/ui-bootstrap-tpls-1.3.2.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> -->


<script src="/js/MyAccount.js"></script>
<script src="/js/booking.js"></script>
<script src="/js/common.js"></script>

<!--D3 Library-->
<script src="http://d3js.org/d3.v3.min.js"></script>


<!--Gauge graph-->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/highcharts-more.js"></script>
<script src="https://code.highcharts.com/highcharts-3d.js"></script>
<script src="https://code.highcharts.com/modules/solid-gauge.js"></script>

<!-- MetisMenu CSS -->
<link href="/stylesheets/metisMenu.min.css" rel="stylesheet">

<!-- Timeline CSS -->
<link href="/stylesheets/timeline.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="/stylesheets/sb-admin-2.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="/stylesheets/font-awesome.min.css" rel="stylesheet"
	type="text/css">

<!-- Profile CSS -->
<link href="/stylesheets/profile.css" rel="stylesheet">

<link media="all" type="text/css" rel="stylesheet"
	href="/stylesheets/myaccount.css">
<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body ng-controller="layoutmodule">
	<div id="wrapper">
		<!-- Navigation -->
		<nav class="navbar navbar-default navbar-static-top" role="navigation"
			style="margin-bottom: 0; position: fixed; width: 100%;">
			<table id="navtable" width="100%">
				<tr>
					<td><div class="navbar-header" style="display: block;">
							<div class="dropdown" style="float: left;">
								<button class="dropbtn" onclick="toggle(this);">
									<i class="fa fa-home fa-fw menuSize"></i>Menu
								</button>
								<div id="navMenus" class="dropdown-content" style="left: 0;">
									<ul class="nav" id="side-menu">
										<li><a class="aNav" href="/"><p align="center">
													<i class="fa fa fa-bookmark fa-fw menuSize"></i>
												</p>
												<p align="center">Reservation</p></a></li>
										<li ng-click="account();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-child fa-fw menuSize"></i>
												</p>
												<p align="center">User Details</p></a></li>

										<li ng-click="billing();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-money fa-fw menuSize"></i>
												</p>
												<p align="center">Billing</p></a></li>
										<li ng-click="details();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-book fa-fw menuSize"></i>
												</p>
												<p align="center">Reviews</p></a></li>
										<li ng-click="dashboard();"><a class="aNav" href="#"><p
													align="center">
													<i class="fa fa-bar-chart-o fa-fw menuSize"></i>
												</p>
												<p align="center">Dashboard</p></a></li>
									</ul>
								</div>
							</div>
							<a class="navbar-brand" href="/">ParkWiz</a>
						</div> <!-- /.navbar-header --></td>
					<td>
						<div style="float: right;">
							<ul id="subdiv" class="nav navbar-top-links navbar-right">
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-tasks fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-tasks">
										<li><a href="#">
												<div>
													<p>
														<strong>Task 1</strong> <span
															class="pull-right text-muted">40% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-success"
															role="progressbar" aria-valuenow="40" aria-valuemin="0"
															aria-valuemax="100" style="width: 40%">
															<span class="sr-only">40% Complete (success)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 2</strong> <span
															class="pull-right text-muted">20% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-info"
															role="progressbar" aria-valuenow="20" aria-valuemin="0"
															aria-valuemax="100" style="width: 20%">
															<span class="sr-only">20% Complete</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 3</strong> <span
															class="pull-right text-muted">60% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-warning"
															role="progressbar" aria-valuenow="60" aria-valuemin="0"
															aria-valuemax="100" style="width: 60%">
															<span class="sr-only">60% Complete (warning)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<p>
														<strong>Task 4</strong> <span
															class="pull-right text-muted">80% Complete</span>
													</p>
													<div class="progress progress-striped active">
														<div class="progress-bar progress-bar-danger"
															role="progressbar" aria-valuenow="80" aria-valuemin="0"
															aria-valuemax="100" style="width: 80%">
															<span class="sr-only">80% Complete (danger)</span>
														</div>
													</div>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Tasks</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<!--<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-bell fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-alerts">
										<li><a href="#">
												<div>
													<i class="fa fa-comment fa-fw"></i> New Comment <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-twitter fa-fw"></i> 3 New Followers <span
														class="pull-right text-muted small">12 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-envelope fa-fw"></i> Message Sent <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-tasks fa-fw"></i> New Task <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a href="#">
												<div>
													<i class="fa fa-upload fa-fw"></i> Server Rebooted <span
														class="pull-right text-muted small">4 minutes ago</span>
												</div>
										</a></li>
										<li class="divider"></li>
										<li><a class="text-center" href="#"> <strong>See
													All Alerts</strong> <i class="fa fa-angle-right"></i>
										</a></li>
									</ul></li> -->
								<!-- /.dropdown -->
								<li class="dropdown"><a class="dropdown-toggle"
									data-toggle="dropdown" href="#"> <i
										class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
								</a>
									<ul class="dropdown-menu dropdown-user">
										<li id="myaccount" ng-click="account();"><a href="#"><i
												class="fa fa-user fa-fw"></i> My Account</a></li>
										<li class="divider"></li>
										<li id="bookinghistory" ng-click="bookinghistory();"><a
											href="#"><i class="fa fa-calendar fa-fw"></i> Booking
												History</a></li>
										<li class="divider"></li>
										<li><a href="#"><i class="fa fa-gear fa-fw"></i>
												Settings</a></li>
										<li class="divider"></li>
										<li><a ng-click="logout()"><i
												class="fa fa-sign-out fa-fw"></i> Logout</a></li>
									</ul> <!-- /.dropdown-user --></li>
								<!-- /.dropdown -->
							</ul>
							<!-- /.navbar-top-links -->
						</div>
					</td>
				</tr>
			</table>



		</nav>

		<div id="page-wrapper">
			<div ng-include src="template.url"></div>
			<br />
		</div>
		<!-- /#page-wrapper -->

	</div>
	<!-- /#wrapper -->

	<!-- Bootstrap Core JavaScript -->
	<!-- <script src="/js/bootstrap.min.js"></script> -->

	<!-- Metis Menu Plugin JavaScript -->
	<script src="/js/metisMenu.min.js"></script>

	<!-- Custom Theme JavaScript -->
	<script src="/js/sb-admin-2.js"></script>


</body>

<script>
	var autocomplete;
	var curPage = 1;
	//var searchdata;
	var privateParkingList;

	angular.module('myApp', [ 'ngAnimate', 'ui.bootstrap' ]);
	angular.module('myApp').controller('layoutmodule', layoutmodule);
	function layoutmodule($scope, $http) {
		var templateName = "Search Page"; // Search is the default url.
		if (typeof (Storage) !== "undefined") {
			templateName = sessionStorage.getItem("template");
			if (!templateName) {
				templateName = "Search Page";
			} else {
				sessionStorage.removeItem("template");
			}
		}

		$scope.addlistings = function() {
			$scope.template = $scope.templates[5];
			$("#navMenus").hide();
		};

		$scope.details = function() {
			$scope.template = $scope.templates[6];
			$("#navMenus").hide();
		}

		$scope.billing = function() {
			$scope.template = $scope.templates[1];
			$("#navMenus").hide();
		};

		$scope.dashboard = function() {
			$scope.template = $scope.templates[7];
			$("#navMenus").hide();
		};

		$scope.bookinghistory = function() {
			$scope.template = $scope.templates[4];
			$("#navMenus").hide();
		};

		$scope.account = function() {
			$scope.template = $scope.templates[3];
			initializeMyAccount($scope, $http);

			$("#navMenus").hide();
		};

		$scope.templates = [ {
			name : 'Search Page',
			url : '/search',
			initializeFunction : undefined
		}, {
			name : 'My Billing History',
			url : '/billing',
			initializeFunction : undefined
		}, {
			name : 'Billing',
			url : '/payment'
		}, {
			name : 'My Account',
			url : '/profile',
			initializeFunction : initializeMyAccount
		}, {
			name : 'My Booking History',
			url : '/bookings',
			initializeFunction : function($scope, $http) {
				$scope.bookingInfo = [ {
					'location' : 'blah st, San Jose, Ca',
					'from' : '01/01/2016',
					'to' : '01/03/2016',
					'status' : 'Completed'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '02/01/2016',
					'to' : '02/03/2016',
					'status' : 'Pending'
				}, {
					'location' : 'blah st, San Jose, Ca',
					'from' : '04/01/2015',
					'to' : '04/03/2015',
					'status' : 'Completed'
				} ];
			}
		}, {
			name : 'AddListing',
			url : '/addlisting'
		}, {
			name : 'Details',
			url : '/details'
		}, {
			name : 'Dashboard',
			url : '/dashboard'
		} ];

		$scope.templates.forEach(function(template) {
			if (template['name'] == templateName) {
				$scope.template = template;
			}
			if (template['name'] == templateName) {
				$scope.template = template;
				if (template.initializeFunction) {
					template.initializeFunction($scope, $http);
				}
			}
		});

		if (sessionStorage.getItem("latest_template")) {
			var o = JSON.parse(sessionStorage.getItem("latest_template"));
			sessionStorage.setItem("latest_template", null);
			$scope.template = o;
		}

		$scope.detail = function(spotid) {
			sessionStorage.setItem("spot_id", spotid);
			sessionStorage.setItem("latest_template", JSON
					.stringify($scope.templates[6]));
			location.reload();
		}

		//initialize();

		$scope.logout = function() {
			$http({
				method : 'DELETE',
				url : '/api/session'
			}).success(function(response) {
				window.location = '/signin';
			}).error(function(error) {
				window.location = '/signin';
			});
		};
	}
	angular.module('myApp').controller('searchmodule', searchmodule);
	function searchmodule($scope, $http) {

		initMap();
		$scope.searchParking = function() {

			searchParkings();

			setTimeout(
					function() {
						var data = getParkingList();
						//$scope.privateparkingresult = getParkingList();
						var privateparkingresult = JSON.parse(data);
						//alert(data[0].state);
						//console.log(JSON.stringify(data));

						var htmlval = "";

						for (var i = 0; i < privateparkingresult.length; i++) {
							htmlval += '<tr>';
							htmlval += '<td style="width: 20%"><div align="center" class="image">';
							htmlval += '<img style="width: 30%; height: 30%;"';
							htmlval += 'src="https://static.yourparkingspace.co.uk/8963d0b7ecca07ef6fd89760ee6378e3.jpeg"';
							htmlval += 'alt="Parking on 84 N 7th Street, "></div></td>';
							htmlval += '<td style="width: 60%"><div align="center">'
									+ privateparkingresult[i].addressline1
									+ '</div></td>';
							htmlval += '<td><div align="center"><a onclick="getDetails(this,'
									+ privateparkingresult[i].spotid
									+ ');" class="bookingnav" >Details</a>';
							htmlval += '</div></td><td><div align="center">';
							htmlval += '<button type="button" class="btn btn-success" onclick="reserveParking('
									+ privateparkingresult[i].spotid
									+ ')">Reserve</button>';
							htmlval += '</div></td></tr>';
						}

						$("#tbodyTabularview").append(htmlval);
						//alert("data "+data);
					}, 1000);

		};

	}

	function reserveParking(spotid) {
		alert("Here" + spotid);
		var userid = 1;
		//console.log("... "+$scope.startdate);
		//searchdata = {"startdate": $scope.startdate};
		reserveParkingSpot(userid, spotid);
	}

	function getDetails(el, spotid) {
		var $s = angular.element(el).scope();
		//$scope.thing = newVal;
		$s.$parent.detail(spotid);
	}

	angular.module('myApp').controller('profilemodule', profilemodule);
	function profilemodule($scope, $http) {
		$(".progress-bar").animate({
			width : "70%"
		}, 2500);
	}

	angular.module('myApp').controller('bookingModule', bookingModule);
</script>

<script>
	$(".aNav").click(function() {
		$(".aNav").each(function(val) {
			this.className = "aNav";
		});

		this.className = "aNav active";
	});

	function togglenav(e) {
		$(".bookingnav").each(function(val) {
			this.className = "bookingnav";
		});

		e.className = "bookingnav active";
	}
</script>



<script>
	function toggle(e) {
		$("#navMenus").toggle();
	}

	$(function() {
		$('#tabs a:last').tab('show');
	});
</script>
<script>
	var map;
	var infowindow;
	var locations;
	function initMap() {
		var width = document.getElementById('mapContent').offsetWidth;
		var height = document.getElementById('mapContent').offsetHeight;
		$("#map").width(width).height(height);

		var mapDiv = document.getElementById('map');
		map = new google.maps.Map(mapDiv, {
			center : {
				lat : 44.540,
				lng : -78.546
			},
			zoom : 15
		});
	}
	function callback(results, status) {
		if (status === google.maps.places.PlacesServiceStatus.OK) {
			for (var i = 0; i < results.length; i++) {
				createMarker(results[i]);
			}
		}
	}

	function createMarker(place) {
		var placeLoc = place.geometry.location;
		var marker = new google.maps.Marker({
			map : map,
			animation : google.maps.Animation.DROP,
			position : place.geometry.location
		});

		google.maps.event.addListener(marker, 'click', function() {
			infowindow.setContent(place.name);
			infowindow.open(map, this);
		});
	}

	function searchParkings() {
		//alert("Looking for place: " +document.getElementById('txtAddress').value);
		var geocoder = new google.maps.Geocoder();
		var address = document.getElementById('txtAddress').value;
		var latitude = 44.540, longitude = -78.546;

		//to convert the destination address into lat long values
		geocoder.geocode({
			'address' : address
		}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				latitude = results[0].geometry.location.lat();
				longitude = results[0].geometry.location.lng();
				//alert(latitude);
				progressWithLatLong(latitude, longitude);
			}
		});
	}

	function progressWithLatLong(latitude, longitude) {

		//alert(map.getCenter());
		map.setCenter(new google.maps.LatLng(latitude, longitude));

		var pyrmont = {
			lat : latitude,
			lng : longitude
		};

		infowindow = new google.maps.InfoWindow();
		var service = new google.maps.places.PlacesService(map);
		service.nearbySearch({
			location : pyrmont,
			radius : 1000,
			type : [ 'parking' ]
		}, callback);

		createDestinationMarker(latitude, longitude);
		getPrivateParking(latitude, longitude);
	}

	function createDestinationMarker(latitude, longitude) {
		var MARKER_PATH = 'https://maps.gstatic.com/intl/en_us/mapfiles/marker_yellow';
		var markerIcon = MARKER_PATH + 'D' + '.png';
		var marker = new google.maps.Marker({
			map : map,
			position : {
				lat : latitude,
				lng : longitude
			},
			title : document.getElementById('txtAddress').value,
			animation : google.maps.Animation.DROP,
			icon : markerIcon
		});
		marker.addListener('click', function() {
			infowindow.open(map, this);
			infowindow.setContent(this.title);
		});
	}

	function getPrivateParking(latitude, longitude) {
		var latlongvalues = [];
		$.ajax({
			type : 'GET',
			url : '/privateParking',
			data : {
				"latitude" : latitude,
				"longitude" : longitude
			}
		}).success(function(response) {
			//alert("success");
			latlongvalues.push(JSON.stringify(response));
			var privateparkingjson = {
				'locations' : latlongvalues[0]
			};
			setParkingList(privateparkingjson)
			plotPins(privateparkingjson);
			//alert("FINISH");
		}).error(function(error) {
			alert("error");
		});
	}

	function getParkingList() {
		return privateParkingList;
	}

	function setParkingList(privateparkingjson) {
		privateParkingList = privateparkingjson.locations;
		//alert("getting parking" +privateParkingList);
		//alert("privateParkingList: "+privateParkingList);
	}

	function plotPins(privateparkingjson) {
		var MARKER_PATH = 'https://maps.gstatic.com/intl/en_us/mapfiles/marker_green';
		var privateparking = privateparkingjson;
		var locations = JSON.parse(privateparking.locations);

		for (var i = 0; i < locations.length; i++) {
			var address2 = locations[i].addressline2 == null ? ''
					: locations[i].addressline2;
			var addr = locations[i].addressline1 + ' ' + address2;
			var lat = parseFloat(locations[i].latitude);
			var lng = parseFloat(locations[i].longitude);
			var markerLetter = String.fromCharCode('A'.charCodeAt(0) + i);
			var markerIcon = MARKER_PATH + markerLetter + '.png';
			var marker = new google.maps.Marker({
				map : map,
				position : {
					lat : lat,
					lng : lng
				},
				title : addr,
				animation : google.maps.Animation.DROP,
				icon : markerIcon
			});
			marker
					.addListener(
							'click',
							function() {
								var htmlText = document.createElement("html");
								htmlText.innerHTML = "<head><link href='/stylesheets/bootstrap.min.css' rel='stylesheet'/><link rel='stylesheet' href='style.css'/></head><body style='background-color: #fff!important;'><h5>"
										+ this.title
										+ "</h5><button align='center' type='button' class='btn btn-success'>Reserve</button><body>";
								infowindow.open(map, this);
								infowindow.setContent(htmlText);
							});
		}
	}

	function geolocate() {
		autocomplete = new google.maps.places.Autocomplete((document
				.getElementsByClassName('locationservice')[0]), {
			types : [ 'geocode' ]
		});

		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(function(position) {
				var geolocation = {
					lat : position.coords.latitude,
					lng : position.coords.longitude
				};
				var circle = new google.maps.Circle({
					center : geolocation,
					radius : position.coords.accuracy
				});
				autocomplete.setBounds(circle.getBounds());
			});
		}
	}

	function reserveParkingSpot(userid, spotid) {
		validatePaymentInfo(userid, spotid);
	}

	function validatePaymentInfo(userid, spotid) {
		$.ajax({
			type : 'GET',
			url : '/checkPaymentInfo',
			data : {
				"userid" : userid,
				"spotid" : spotid
			}
		}).success(function(response) {
			if (response) {
				createReservation();
			} else {
				createReservation();
				//location.href="/payment";		 
			}
			alert("success");
		}).error(function(error) {
			alert("error");
		});
	}

	function createReservation() {
		console.log("inside create reservation");
		$.ajax({
			type : 'GET',
			url : '/createReservation',
			data : {
				"userid" : userid,
				"spotid" : spotid,
				"searchtime" : document.getElementById('#txtorigindate')
			}
		}).success(function(response) {
			alert("success");
		}).error(function(error) {
			alert("error");
		});
	}
</script>

<script>
	angular.module('myApp').controller('detailsModule', detailsModule);
	function detailsModule($scope, $http) {

		$scope.detailtemplates = [ {
			name : 'Availability',
			url : '/availability'
		}, {
			name : 'Availability Chart',
			url : '/availabilitychart'
		}, {
			name : 'Images',
			url : '/images'
		}, {
			name : 'reviews',
			url : '/reviews'
		} ];

		$scope.details = $scope.detailtemplates[0];
		$scope.availability = function() {
			$scope.details = $scope.detailtemplates[0];
		};

		$scope.availabilitychart = function() {
			$scope.details = $scope.detailtemplates[1];
		};

		$scope.images = function() {
			$scope.details = $scope.detailtemplates[2];
		};

		$scope.reviews = function() {
			$scope.details = $scope.detailtemplates[3];
		};

		$('#carouselHacked').carousel();
	}
</script>

<script>
	angular.module('myApp').controller('reviewController', reviewController);
	function reviewController($scope, $http, $location) {
		var spotid = 2;
		var reviewadded = false;

		$scope.init = function() {
			loadChartValues();
			loadReviews();

		};

		$scope.submit = function() {
			console.log($scope.newRating);
			console.log($scope.newReview);
			if ($scope.newRating != null && $scope.newReview != null) {
				$http({
					method : 'POST',
					url : '/savereview',
					data : {
						"spotid" : spotid,
						"review" : $scope.newReview,
						"rating" : $scope.newRating
					}
				})
						.success(
								function(response) {
									var resp = JSON.parse(JSON
											.stringify(response));
									document.getElementById("reviewresult").innerHTML = resp;
									$('#reviewbody').hide();
									console.log(resp);
									reviewadded = true;
								})
						.error(
								function(error) {
									document.getElementById("reviewresult").innerHTML = "Adding review failed";
								});
			}
		};

		$scope.reloadData = function() {
			if (reviewadded)
				window.location.reload();
		};

		function loadReviews() {
			$http({
				method : 'GET',
				url : '/getallreviews?spotid=' + spotid
			}).success(function(response) {
				var resp = JSON.parse(JSON.stringify(response));
				$scope.reviews = resp.reviews;
				console.log($scope.reviews);
			}).error(function(error) {
				alert(error);
			});
		}

		function loadChartValues() {
			$http({
				method : 'GET',
				url : '/getreviewschart?spotid=' + spotid
			}).success(function(response) {
				console.log(JSON.stringify(response));
				var json = JSON.stringify(response);
				var chartVal = $.map(response, function(obj, i) {
					return [ [ "Rating " + obj.rating, obj.ratingcnt ] ];
				})
				console.log(chartVal);
				createChart(chartVal);
			}).error(function(error) {
				alert(error);
			});
		}

		function createChart(chartVal) {
			$(function() {
				Highcharts.setOptions({
					colors : [ '#cc0000', '#ff6600', '#ffcc00', '#99cc00',
							'#006600' ]
				});
				$('#chart')
						.highcharts(
								{
									chart : {
										plotBackgroundColor : null,
										plotBorderWidth : null,
										plotShadow : false,
										type : 'pie',
										options3d : {
											enabled : true,
											alpha : 20,
											beta : 3

										}

									},
									credits : {
										enabled : false
									},
									title : {
										text : null
									},
									subtitle : {
										text : null
									},
									tooltip : {
										pointFormat : '{series.name}: {point.y}, <b>{point.percentage:.1f}%</b>'
									},
									plotOptions : {
										pie : {
											allowPointSelect : true,
											cursor : 'pointer',
											innerSize : 100,
											depth : 45,
											dataLabels : {
												enabled : false
											},
											showInLegend : true
										}
									},
									series : [ {
										name : 'Ratings',
										colorByPoint : true,
										data : chartVal
									} ]
								});
			});

		}

	}
</script>

<script>
	angular.module('myApp').controller('availabilityController',
			availabilityController);
	function availabilityController($scope, $http, $location) {
		var spotid = 2;
		var count1 = 0, count2 = 0, count3 = 0, count4 = 0
		count5 = 0, count6 = 0, count7 = 0;

		$scope.init = function() {
			loadChartValues();
		};

		function loadChartValues() {
			$http({
				method : 'GET',
				url : '/loadavailabilitychart?spotid=' + spotid
			}).success(
					function(response) {
						console.log(JSON.stringify(response));
						$.map(response, function(obj, i) {
							console.log(obj.startday);
							if (obj.startday === "Sunday")
								count1 = count1 + 1;
							else if (obj.startday === "Monday")
								count2 = count2 + 1;
							else if (obj.startday === "Tuesday")
								count3 = count3 + 1;
							else if (obj.startday === "Wednesday")
								count4 = count4 + 1;
							else if (obj.startday === "Thursday")
								count5 = count5 + 1;
							else if (obj.startday === "Friday")
								count6 = count6 + 1;
							else if (obj.startday === "Saturday")
								count7 = count7 + 1;
						})
						var chartVal = [ count1, count2, count3, count4,
								count5, count6, count7 ];
						console.log(chartVal);
						createChart(chartVal);
					}).error(function(error) {
				alert(error);
			});
		}

		function createChart(chartVal) {
			$(function() {
				$('#container').highcharts({
					chart : {
						type : 'column',
						options3d : {
							enabled : true

						}
					},
					title : {
						text : 'Space Availability'
					},
					credits : {
						enabled : false
					},
					subtitle : {
						text : null
					},
					plotOptions : {
						column : {
							depth : 25,
							pointWidth : 50
						}
					},
					xAxis : {
						categories : Highcharts.getOptions().lang.weekdays
					},
					yAxis : {
						allowDecimals : false,
						title : {
							text : null
						}
					},
					series : [ {
						name : 'Reservations',
						data : chartVal
					} ]
				});

			});
		}
	}
</script>

<script>
	angular.module('myApp').controller('chartModule', chartModule);
	function chartModule($scope, $http) {
		var w = Math.floor((Math.random() * 1000) + 1);
		+1000;
		//get website traffic
		$http({
			method : 'GET',
			url : '/api/getwebsitetraffic',
			dataType : "json"
		}).success(function(response) {
			$("#trafficval")[0].innerHTML = response + w;
			$("#pageviews")[0].innerHTML = response;
		}).error(function(error) {
			alert(error);
		});

		//get number of users
		$http({
			method : 'GET',
			url : '/api/getnumberofusers',
			dataType : "json"
		}).success(function(response) {
			$("#noofusers")[0].innerHTML = response["count(userid)"];
			$("#sitevisitor")[0].innerHTML = response["count(userid)"] + w;
		}).error(function(error) {
			alert(error);
		});

		//get total sales
		$http({
			method : 'GET',
			url : '/api/gettotalsales',
			dataType : "json"
		})
				.success(
						function(response) {
							$("#totalsales")[0].innerHTML = response["count(reservationid)"];
							$("#totalclick")[0].innerHTML = response["count(reservationid)"]
									+ w + w + w;
						}).error(function(error) {
					alert(error);
				});

		$("#chart1").sparkline(
				[ 5, 6, 7, 5, 4, 7, 6, 4, 5, 6, 7, 5, 4, 7, 6, 4, 6, 7, 5, 4,
						7, 6, 4, 5, 6, 7, 5, 4, 7, 6, 4 ], {
					type : 'bar',
					height : '60',
					barColor : '#ffffff'
				});

		$("#chart2")
				.sparkline(
						[ 5, 6, 7, 9, 9, 5, 3, 2, 2, 4, 6, 7, 6, 7, 9, 9, 5, 3,
								2, 2, 4, 6, 7, 3, 2, 2, 4, 6, 7, 6, 7, 9, 9, 5,
								3, 2, 2, 4, 6, 7, 6, 7, 9, 9, 5, 3, 2, 2, 4, 6,
								7, 3, 2, 2, 4, 6, 7 ], {
							type : 'line',
							height : '60',
							lineColor : '#ffffff',
							fillColor : '#8bc34a'
						});

		$("#chart3").sparkline(
				[ 5, 6, 7, 5, 4, 7, 6, 4, 5, 6, 7, 5, 4, 7, 6, 4, 6, 7, 5, 4,
						7, 6, 4, 5, 6, 7, 5, 4, 7, 6, 4 ], {
					type : 'bar',
					height : '60',
					barColor : '#ffffff'
				});

		$("#chart4").sparkline(
				[ 5, 6, 7, 9, 9, 5, 5, 6, 7, 9, 9, 5, 3, 2, 2, 4, 6, 7, 6, 7,
						9, 9, 5, 3, 2, 2, 4, 6, 7, 3, 2, 2, 4, 6, 7, 6, 7, 9,
						9, 5, 3, 2, 2, 4, 6, 7, 6, 7, 9, 9, 5, 3, 2, 2, 4, 6,
						7, 3, 2, 2, 4, 6, 7 ], {
					type : 'line',
					width : '200',
					height : '60',
					lineColor : '#f7f7fc',
					fillColor : '#009688'
				});

		var sampleData = {}; /* Sample random data. */
		[ "HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
				"ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY",
				"OH", "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ",
				"NV", "UT", "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS",
				"IN", "IL", "MN", "WI", "MO", "AR", "OK", "KS", "LS", "VA" ]
				.forEach(function(d) {
					var low = Math.round(100 * Math.random()), mid = Math
							.round(100 * Math.random()), high = Math
							.round(100 * Math.random());
					sampleData[d] = {
						low : d3.min([ low, mid, high ]),
						high : d3.max([ low, mid, high ]),
						avg : Math.round((low + mid + high) / 3),
						color : d3.interpolate("#ffffcc", "#800026")(low / 100)
					};
				});

		/* draw states on id #statesvg */
		uStates.draw("#statesvg", sampleData, tooltipHtml);

		$('.odometer').html(456);

		//get priority spots
		$http({
			method : 'GET',
			url : '/api/getpriorityspots',
			dataType : "json"
		})
				.success(
						function(response) {
							$('#container')
									.highcharts(
											{
												title : {
													text : 'Top 5 Spots'
												},
												xAxis : {
													categories : [
															response[0].address,
															response[1].address,
															response[2].address,
															response[3].address,
															response[4].address ]
												},
												labels : {
													items : [ {
														html : 'Total Usage',
														style : {
															left : '50px',
															top : '18px',
															color : (Highcharts.theme && Highcharts.theme.textColor)
																	|| 'black'
														}
													} ]
												},
												series : [
														{
															type : 'column',
															name : 'With Login',
															data : [
																	response[0].count,
																	response[1].count,
																	response[2].count,
																	response[3].count,
																	response[4].count ]
														},
														{
															type : 'column',
															name : 'Without Login',
															data : [
																	response[0].count - 2,
																	response[1].count - 2,
																	response[2].count - 1,
																	response[3].count - 1,
																	response[4].count - 2 ]
														},
														{
															type : 'spline',
															name : 'Average',
															data : [
																	((response[0].count + (response[0].count - 2)) / 2),
																	((response[1].count + (response[1].count - 2)) / 2),
																	((response[2].count + (response[2].count - 2)) / 2),
																	((response[3].count + (response[3].count - 2)) / 2),
																	((response[4].count + (response[4].count - 2)) / 2) ],
															marker : {
																lineWidth : 2,
																lineColor : Highcharts
																		.getOptions().colors[3],
																fillColor : 'white'
															}
														},
														{
															type : 'pie',
															name : 'Total consumption',
															data : [
																	{
																		name : 'With Login',
																		y : response[0].count
																				+ response[1].count
																				+ response[2].count
																				+ response[3].count
																				+ response[4].count,
																		color : Highcharts
																				.getOptions().colors[0]
																	// Jane's color
																	},
																	{
																		name : 'Without Login',
																		y : response[0].count
																				- 2
																				+ response[1].count
																				- 2
																				+ response[2].count
																				- 1
																				+ response[3].count
																				- 1
																				+ response[4].count
																				- 2,
																		color : Highcharts
																				.getOptions().colors[1]
																	// John's color
																	} ],
															center : [ 300, 30 ],
															size : 100,
															showInLegend : false,
															dataLabels : {
																enabled : false
															}
														} ]
											});
						}).error(function(error) {
					alert(error);
				});

		//api call to fetch the data

		var low1 = 12, low2 = 7, low3 = 7, low4 = 6, low5 = 7, low6 = 8;
		var high1 = 7, high2 = 6, high3 = 3, high4 = 3, high5 = 4, high6 = 5;
		var add1 = 'Spot 1', add2 = 'Spot 2', add3 = 'Spot 3', add4 = 'Spot 4', add5 = 'Spot 5', add6 = 'Spot 6';

		//get low values
		$http({
			method : 'GET',
			url : '/api/getlowreviewvalues',
			dataType : "json"
		}).success(function(res) {
			l1 = res[0].low;
			low2 = res[1].low;
			low3 = res[2].low;
			low4 = res[3].low;
			low5 = res[4].low;
			low6 = res[5].low;

			add1 = res[0].address;
			add2 = res[1].address;
			add3 = res[2].address;
			add4 = res[3].address;
			add5 = res[4].address;
			add6 = res[5].address;

			//get high values
			$http({
				method : 'GET',
				url : '/api/gethighreviewvalues',
				dataType : "json"
			}).success(function(response) {
				high1 = response[0].high;
				high2 = response[1].high;
				high3 = response[2].high;
				high4 = response[3].high;
				high5 = response[4].high;
				high6 = response[5].high;

				var freqData = [ {
					State : add1,
					freq : {
						low : low1,
						mid : 0,
						high : 7
					}
				}, {
					State : add2,
					freq : {
						low : low2,
						mid : 0,
						high : 6
					}
				}, {
					State : add3,
					freq : {
						low : low3,
						mid : 0,
						high : 3
					}
				}, {
					State : add4,
					freq : {
						low : low4,
						mid : 0,
						high : 3
					}
				}, {
					State : add5,
					freq : {
						low : low5,
						mid : 0,
						high : 4
					}
				}, {
					State : add6,
					freq : {
						low : low6,
						mid : 0,
						high : 5
					}
				} ];

				dashboard('#dashboard', freqData);

			}).error(function(error) {
				alert(error);
			});

		}).error(function(error) {
			alert(error);
		});

		//populatedata();

	}
</script>

<script>
	function dashboard(id, fData) {
		var barColor = 'steelblue';
		function segColor(c) {
			return {
				low : "#807dba",
				mid : "#e08214",
				high : "#41ab5d"
			}[c];
		}

		// compute total for each state.
		fData.forEach(function(d) {
			d.total = d.freq.low + d.freq.mid + d.freq.high;
		});

		// function to handle histogram.
		function histoGram(fD) {
			var hG = {}, hGDim = {
				t : 60,
				r : 0,
				b : 30,
				l : 0
			};
			hGDim.w = 800 - hGDim.l - hGDim.r, hGDim.h = 300 - hGDim.t
					- hGDim.b;

			//create svg for histogram.
			var hGsvg = d3.select(id).append("svg").attr("width",
					hGDim.w + hGDim.l + hGDim.r).attr("height",
					hGDim.h + hGDim.t + hGDim.b).append("g").attr("transform",
					"translate(" + hGDim.l + "," + hGDim.t + ")");

			// create function for x-axis mapping.
			var x = d3.scale.ordinal().rangeRoundBands([ 0, hGDim.w ], 0.1)
					.domain(fD.map(function(d) {
						return d[0];
					}));

			// Add x-axis to the histogram svg.
			hGsvg.append("g").attr("class", "x axis").attr("transform",
					"translate(0," + hGDim.h + ")").call(
					d3.svg.axis().scale(x).orient("bottom"));

			// Create function for y-axis map.
			var y = d3.scale.linear().range([ hGDim.h, 0 ]).domain(
					[ 0, d3.max(fD, function(d) {
						return d[1];
					}) ]);

			// Create bars for histogram to contain rectangles and freq labels.
			var bars = hGsvg.selectAll(".bar").data(fD).enter().append("g")
					.attr("class", "bar");

			//create the rectangles.
			bars.append("rect").attr("x", function(d) {
				return x(d[0]);
			}).attr("y", function(d) {
				return y(d[1]);
			}).attr("width", x.rangeBand()).attr("height", function(d) {
				return hGDim.h - y(d[1]);
			}).attr('fill', barColor).on("mouseover", mouseover)// mouseover is defined below.
			.on("mouseout", mouseout);// mouseout is defined below.

			//Create the frequency labels above the rectangles.
			bars.append("text").text(function(d) {
				return d3.format(",")(d[1])
			}).attr("x", function(d) {
				return x(d[0]) + x.rangeBand() / 2;
			}).attr("y", function(d) {
				return y(d[1]) - 5;
			}).attr("text-anchor", "middle");

			function mouseover(d) { // utility function to be called on mouseover.
				// filter for selected state.
				var st = fData.filter(function(s) {
					return s.State == d[0];
				})[0], nD = d3.keys(st.freq).map(function(s) {
					return {
						type : s,
						freq : st.freq[s]
					};
				});

				// call update functions of pie-chart and legend.    
				pC.update(nD);
				leg.update(nD);
			}

			function mouseout(d) { // utility function to be called on mouseout.
				// reset the pie-chart and legend.    
				pC.update(tF);
				leg.update(tF);
			}

			// create function to update the bars. This will be used by pie-chart.
			hG.update = function(nD, color) {
				// update the domain of the y-axis map to reflect change in frequencies.
				y.domain([ 0, d3.max(nD, function(d) {
					return d[1];
				}) ]);

				// Attach the new data to the bars.
				var bars = hGsvg.selectAll(".bar").data(nD);

				// transition the height and color of rectangles.
				bars.select("rect").transition().duration(500).attr("y",
						function(d) {
							return y(d[1]);
						}).attr("height", function(d) {
					return hGDim.h - y(d[1]);
				}).attr("fill", color);

				// transition the frequency labels location and change value.
				bars.select("text").transition().duration(500).text(
						function(d) {
							return d3.format(",")(d[1])
						}).attr("y", function(d) {
					return y(d[1]) - 5;
				});
			}
			return hG;
		}

		// function to handle pieChart.
		function pieChart(pD) {
			var pC = {}, pieDim = {
				w : 250,
				h : 250
			};
			pieDim.r = Math.min(pieDim.w, pieDim.h) / 2;

			// create svg for pie chart.
			var piesvg = d3.select(id).append("svg").attr("width", pieDim.w)
					.attr("height", pieDim.h).append("g").attr(
							"transform",
							"translate(" + pieDim.w / 2 + "," + pieDim.h / 2
									+ ")");

			// create function to draw the arcs of the pie slices.
			var arc = d3.svg.arc().outerRadius(pieDim.r - 10).innerRadius(0);

			// create a function to compute the pie slice angles.
			var pie = d3.layout.pie().sort(null).value(function(d) {
				return d.freq;
			});

			// Draw the pie slices.
			piesvg.selectAll("path").data(pie(pD)).enter().append("path").attr(
					"d", arc).each(function(d) {
				this._current = d;
			}).style("fill", function(d) {
				return segColor(d.data.type);
			}).on("mouseover", mouseover).on("mouseout", mouseout);

			// create function to update pie-chart. This will be used by histogram.
			pC.update = function(nD) {
				piesvg.selectAll("path").data(pie(nD)).transition().duration(
						500).attrTween("d", arcTween);
			}
			// Utility function to be called on mouseover a pie slice.
			function mouseover(d) {
				// call the update function of histogram with new data.
				hG.update(fData.map(function(v) {
					return [ v.State, v.freq[d.data.type] ];
				}), segColor(d.data.type));
			}
			//Utility function to be called on mouseout a pie slice.
			function mouseout(d) {
				// call the update function of histogram with all data.
				hG.update(fData.map(function(v) {
					return [ v.State, v.total ];
				}), barColor);
			}
			// Animating the pie-slice requiring a custom function which specifies
			// how the intermediate paths should be drawn.
			function arcTween(a) {
				var i = d3.interpolate(this._current, a);
				this._current = i(0);
				return function(t) {
					return arc(i(t));
				};
			}
			return pC;
		}

		// function to handle legend.
		function legend(lD) {
			var leg = {};

			// create table for legend.
			var legend = d3.select(id).append("table").attr('class', 'legend');

			// create one row per segment.
			var tr = legend.append("tbody").selectAll("tr").data(lD).enter()
					.append("tr");

			// create the first column for each segment.
			tr.append("td").append("svg").attr("width", '16').attr("height",
					'16').append("rect").attr("width", '16').attr("height",
					'16').attr("fill", function(d) {
				return segColor(d.type);
			});

			// create the second column for each segment.
			tr.append("td").text(function(d) {
				return d.type;
			});

			// create the third column for each segment.
			tr.append("td").attr("class", 'legendFreq').text(function(d) {
				return d3.format(",")(d.freq);
			});

			// create the fourth column for each segment.
			tr.append("td").attr("class", 'legendPerc').text(function(d) {
				return getLegend(d, lD);
			});

			// Utility function to be used to update the legend.
			leg.update = function(nD) {
				// update the data attached to the row elements.
				var l = legend.select("tbody").selectAll("tr").data(nD);

				// update the frequencies.
				l.select(".legendFreq").text(function(d) {
					return d3.format(",")(d.freq);
				});

				// update the percentage column.
				l.select(".legendPerc").text(function(d) {
					return getLegend(d, nD);
				});
			}

			function getLegend(d, aD) { // Utility function to compute percentage.
				return d3.format("%")(d.freq / d3.sum(aD.map(function(v) {
					return v.freq;
				})));
			}

			return leg;
		}

		// calculate total frequency by segment for all state.
		var tF = [ 'low', 'high' ].map(function(d) {
			return {
				type : d,
				freq : d3.sum(fData.map(function(t) {
					return t.freq[d];
				}))
			};
		});

		// calculate total frequency by state for all segment.
		var sF = fData.map(function(d) {
			return [ d.State, d.total ];
		});

		var hG = histoGram(sF), // create the histogram.
		pC = pieChart(tF), // create the pie-chart.
		leg = legend(tF); // create the legend.
	}

	function tooltipHtml(n, d) { /* function to create html content string in tooltip div. */
		return "<h4 style='z-index: 1000'>" + n
				+ "</h4><table style='z-index: 1000'>" + "<tr><td>Low</td><td>"
				+ (d.low) + "</td></tr>" + "<tr><td>Average</td><td>" + (d.avg)
				+ "</td></tr>" + "<tr><td>High</td><td>" + (d.high)
				+ "</td></tr>" + "</table>";
	}
</script>

<script>
	angular.module('myApp').controller('imagemodule', imagemodule);
	function imagemodule($scope, $http) {

		$scope.opennewwindow = function(event) {
			localStorage.setItem("imageurl", event.target.src.substring(21,
					event.target.src.length));
			var win = window.open('/panaroma', 'ParkWiz');
			if (win) {
				//Browser has allowed it to be opened
				win.focus();
			} else {
				//Broswer has blocked it
				alert('Please allow popups for this site');
			}
		}

		$scope.init = function() {
			spotid = 3;
			$http({
				method : 'GET',
				url : '/getAllImages?spotid=' + spotid
			}).success(
					function(response) {
						var v = JSON.parse(JSON.stringify(response));
						var v1 = v[1];
						var v2 = v[0];
						$scope.activeimage = v1[0];
						v1.shift();
						$scope.spotimages = v1;
						$scope.panaromaactiveimage = v2[0];
						v2.shift();
						$scope.panaromaimages = v2;
						console.log($scope.spotimages + "..."
								+ $scope.activeimage);
						console.log($scope.panaromaactiveimage.imageurl + "..."
								+ $scope.panaromaimages);
						alert("success");
					}).error(function(error) {
				alert(error);
			});
		};
	}
</script>

<script>
	angular.module('myApp').controller('addListingController',
			addListingController);
	function addListingController($scope, $http) {
	}

	angular.module('myApp').controller('addPaymentController',
			addPaymentController);
	function addPaymentController($scope, $http) {

	}
</script>

<script>
	angular.module('myApp').controller('bookinghistoryModule',
			bookinghistoryModule);
	function bookinghistoryModule($scope, $http) {

		$scope.recordCount = {
			data : [ {
				value : '10',
				name : '10'
			}, {
				value : '20',
				name : '20'
			}, {
				value : '50',
				name : '50'
			}, {
				value : '100',
				name : '100'
			} ]
		};
		
		$scope.noofrecords = '10';

		// calling get user listing
		$http({
			method : 'GET',
			url : '/api/getuserlisting/10/0',
			dataType : "json"
		}).success(function(response) {
			$scope.bookingInfos = response;
			insertPaging(response[0].Totalrows, 1, $scope.noofrecords);
		}).error(function(error) {
			alert(error);
		});
		
		$scope.getdataforgrid = function(){
        	var records = $scope.noofrecords;
        	var offset = 0;
        	if($(event)[0].currentTarget.title == undefined || $(event)[0].currentTarget.title == ""){
        		offset = (parseInt(curPage) - 1) * parseInt(records);
        	}
        	else{
				offset = (parseInt($(event)[0].currentTarget.title) - 1) * parseInt(records);
			}
        	var url = "/api/getuserlisting/"+records+"/" + offset;
                $http({
                    method: 'GET',
                    url: url
                }).success(function(response){
                	$scope.bookingInfos = response;
        			insertPaging(response[0].Totalrows, 1, $scope.noofrecords);
                }).error(function(err){
                    alert(err.value.message);
           });
        };
	}
</script>
<script>
	angular.module('myApp')
			.controller('availabilitymodule', availabilitymodule);
	function availabilitymodule($scope, $http) {
		spotid = 2;
		var timeslot1 = [ {
			'time' : '12:00',
			'bgcolor' : ''
		}, {
			'time' : '1:00',
			'bgcolor' : ''
		}, {
			'time' : '2:00',
			'bgcolor' : ''
		}, {
			'time' : '3:00',
			'bgcolor' : ''
		} ];
		var timeslot2 = [ {
			'time' : '4:00',
			'bgcolor' : ''
		}, {
			'time' : '5:00',
			'bgcolor' : ''
		}, {
			'time' : '6:00',
			'bgcolor' : ''
		}, {
			'time' : '7:00',
			'bgcolor' : ''
		} ];
		var timeslot3 = [ {
			'time' : '8:00',
			'bgcolor' : ''
		}, {
			'time' : '9:00',
			'bgcolor' : ''
		}, {
			'time' : '10:00',
			'bgcolor' : ''
		}, {
			'time' : '11:00',
			'bgcolor' : ''
		} ];
		var timeslot4 = [ {
			'time' : '12:00',
			'bgcolor' : ''
		}, {
			'time' : '13:00',
			'bgcolor' : ''
		}, {
			'time' : '14:00',
			'bgcolor' : ''
		}, {
			'time' : '15:00',
			'bgcolor' : ''
		} ];
		var timeslot5 = [ {
			'time' : '16:00',
			'bgcolor' : ''
		}, {
			'time' : '17:00',
			'bgcolor' : ''
		}, {
			'time' : '18:00',
			'bgcolor' : ''
		}, {
			'time' : '19:00',
			'bgcolor' : ''
		} ];
		var timeslot6 = [ {
			'time' : '20:00',
			'bgcolor' : ''
		}, {
			'time' : '21:00',
			'bgcolor' : ''
		}, {
			'time' : '22:00',
			'bgcolor' : ''
		}, {
			'time' : '23:00',
			'bgcolor' : ''
		} ];
		
		$scope.searchdate = [];
		$scope.init = function() {
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth() + 1; //January is 0!
			var yyyy = today.getFullYear();
			if (dd < 10) {
				dd = '0' + dd
			}
			if (mm < 10) {
				mm = '0' + mm
			}
			today = dd + '-' + mm + '-' + yyyy;
			searchdate = yyyy + '-' + mm + '-' + dd;
			;
			//var searchdate=document.getElementById('searchAvailabilityDate').value;
			$http(
					{
						method : 'GET',
						url : '/getSpotAvailability?spotid=' + spotid
								+ '&searchdate=' + searchdate
					}).success(
					function(response) {
						var timeslots1 = timeslot1.slice(0);
						var timeslots2 = timeslot2.slice(0);
						var timeslots3 = timeslot3.slice(0);
						var timeslots4 = timeslot4.slice(0);
						var timeslots5 = timeslot5.slice(0);
						var timeslots6 = timeslot6.slice(0);
						
						var res = JSON.parse(JSON.stringify(response));
						var splits = [];
						if (res) {
							for (var j = 0; j < res.length; j++) {
								var time = splitTimeByMinutes(res[j].starttime,res[j].endtime, 60)[0];
								var number = time.toString().split(':')[0];
								if(number>=0 && number <=3){
									for (var i=0; i<timeslots1.length; i++) {
										  if ((timeslots1[i].time).toString().split(':')[0] == number) {
											  timeslots1[i].bgcolor = "green";
										  }
									}
								}else if(number >=4 && number <=7){
									for (var i=0; i<timeslots2.length; i++) {
										if ((timeslots2[i].time).toString().split(':')[0] == number) {
											  timeslots2[i].bgcolor = "green";
										  }
									}
								}else if(number >=8 && number <=11){
									for (var i=0; i<timeslots3.length; i++) {
										if ((timeslots3[i].time).toString().split(':')[0] == number) {
											  timeslots3[i].bgcolor = "green";
										  }
									}
								}else if(number >=12 && number <=15){
									for (var i=0; i<timeslots4.length; i++) {
										if ((timeslots4[i].time).toString().split(':')[0] == number) {
											  timeslots4[i].bgcolor = "green";
										  }
									}
								}else if(number >=16 && number <=19){
									for (var i=0; i<timeslots5.length; i++) {
										if ((timeslots5[i].time).toString().split(':')[0] == number) {
											  timeslots5[i].bgcolor = "green";
										  }
									}
								}else if(number >=20 && number <=23){
									for (var i=0; i<timeslots6.length; i++) {
										if ((timeslots6[i].time).toString().split(':')[0] == number) {
											  timeslots6[i].bgcolor = "green";
										  }
									}
								}
							}
						}
						
						$scope.timesplits1 = [];
						$scope.timesplits1 = JSON.parse(JSON.stringify(timeslots1));
						
						$scope.timesplits2 = [];
						$scope.timesplits2 = JSON.parse(JSON.stringify(timeslots2));
						
						$scope.timesplits3 = [];
						$scope.timesplits3 = JSON.parse(JSON.stringify(timeslots3));
						
						$scope.timesplits4 = [];
						$scope.timesplits4 = JSON.parse(JSON.stringify(timeslots4));
						
						$scope.timesplits5 = [];
						$scope.timesplits5 = JSON.parse(JSON.stringify(timeslots5));
						
						$scope.timesplits6 = [];
						$scope.timesplits6 = JSON.parse(JSON.stringify(timeslots6));
						
					}).error(function(error) {
				alert(error);
			});
		};
		
		$scope.searchAvailableSlots = function() {
			
			var searchdate=document.getElementById('searchAvailabilityDate').value;
			$http(
					{
						method : 'GET',
						url : '/getSpotAvailability?spotid=' + spotid
								+ '&searchdate=' + searchdate
					}).success(
					function(response) {
						$('.bgclass').css('background-color','#fff');
						
						var timeslots1 = timeslot1.slice(0);
						var timeslots2 = timeslot2.slice(0);
						var timeslots3 = timeslot3.slice(0);
						var timeslots4 = timeslot4.slice(0);
						var timeslots5 = timeslot5.slice(0);
						var timeslots6 = timeslot6.slice(0);
						
						var res = JSON.parse(JSON.stringify(response));
						var splits = [];
						if (res) {
							for (var j = 0; j < res.length; j++) {
								var time = splitTimeByMinutes(res[j].starttime,res[j].endtime, 60)[0];
								var number = time.toString().split(':')[0];
								if(number >=0 && number <=3){
									for (var i=0; i<timeslots1.length; i++) {
										  if ((timeslots1[i].time).toString().split(':')[0] == number) {
											  timeslots1[i].bgcolor = "green";
										  }
									}
								}else if(number >=4 && number <=7){
									for (var i=0; i<timeslots2.length; i++) {
										if ((timeslots2[i].time).toString().split(':')[0] == number) {
											  timeslots2[i].bgcolor = "green";
										  }
									}
								}else if(number >=8 && number <=11){
									for (var i=0; i<timeslots3.length; i++) {
										if ((timeslots3[i].time).toString().split(':')[0] == number) {
											  timeslots3[i].bgcolor = "green";
										  }
									}
								}else if(number >=12 && number <=15){
									for (var i=0; i<timeslots4.length; i++) {
										if ((timeslots4[i].time).toString().split(':')[0] == number) {
											  timeslots4[i].bgcolor = "green";
										  }
									}
								}else if(number >=16 && number <=19){
									for (var i=0; i<timeslots5.length; i++) {
										if ((timeslots5[i].time).toString().split(':')[0] == number) {
											  timeslots5[i].bgcolor = "green";
										  }
									}
								}else if(number >=20 && number <=23){
									for (var i=0; i<timeslots6.length; i++) {
										if ((timeslots6[i].time).toString().split(':')[0] == number) {
											  timeslots6[i].bgcolor = "green";
										  }
									}
								}
							}
						}
						
						$scope.timesplits1 = JSON.parse(JSON.stringify(timeslots1));
						
						$scope.timesplits2 = [];
						$scope.timesplits2 = JSON.parse(JSON.stringify(timeslots2));
						
						$scope.timesplits3 = [];
						$scope.timesplits3 = JSON.parse(JSON.stringify(timeslots3));
						
						$scope.timesplits4 = [];
						$scope.timesplits4 = JSON.parse(JSON.stringify(timeslots4));
						
						$scope.timesplits5 = [];
						$scope.timesplits5 = JSON.parse(JSON.stringify(timeslots5));
						
						$scope.timesplits6 = [];
						$scope.timesplits6 = JSON.parse(JSON.stringify(timeslots6));
						
					}).error(function(error) {
				alert(error);
			});
		};
	}
</script>
<script>
	function splitTimeByMinutes(startTime, endTime, increment){
		    startTime = startTime.toString().split(':');
		    endTime = endTime.toString().split(':');
		    increment = parseInt(increment, 10);

		    var pad = function (n) { return (n < 10) ? '0' + n.toString() : n; },
		        startHr = parseInt(startTime[0], 10),
		        startMin = parseInt(startTime[1], 10),
		        endHr = parseInt(endTime[0], 10),
		        endMin = parseInt(endTime[1], 10),
		        currentHr = startHr,
		        currentMin = startMin,
		        previous = currentHr + ':' + pad(currentMin),
		        current = '',
		        r = [];

		    do {
		        currentMin += increment;
		        if ((currentMin % 60) === 0 || currentMin > 60) {
		            currentMin = (currentMin === 60) ? 0 : currentMin - 60;
		            currentHr += 1;
		        }
		        current = currentHr + ':' + pad(currentMin);
		        //r.push(previous + ' - ' + current);
		        r.push(previous);
		        previous = current;
		  } while (currentHr !== endHr);
			//alert(r);
		    return r;
	}
</script>


</html>
